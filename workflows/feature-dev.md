## Feature Dev - 完整功能开发流程

### 描述
从需求理解到代码审查的完整功能开发流程，确保高质量交付。

### 触发条件
- 开发新功能
- 重大功能修改
- 需要完整流程保障

### 前置条件 (preconditions)

```yaml
checks:
  - name: requirements_clear
    description: 需求已明确
    weight: 20
  - name: project_clean
    description: 项目状态干净（无未提交更改）
    weight: 15
  - name: tests_passing
    description: 现有测试通过
    weight: 15
  - name: environment_ready
    description: 开发环境就绪
    weight: 10

threshold: 40

destructive:
  - overwrite_code: true
```

### 执行配置
- **模式**: strict
- **偏差处理**: block

### 步骤

#### Step 1: 需求理解

- **关键**: true
- **依赖**: []
- **Agent**: none (主对话)
- **并行**: false
- **输出**: 需求确认文档
- **验收**: 用户确认需求理解正确

**任务**: 确认功能边界、约束条件和验收标准。

**检查清单**:
- [ ] 功能目标是什么？
- [ ] 输入输出是什么？
- [ ] 约束条件有哪些？
- [ ] 验收标准是什么？
- [ ] 有哪些技术限制？

**输出**: 需求摘要，等待用户确认

---

#### Step 2: 设计

- **关键**: true
- **依赖**: [1]
- **Agent**: designer
- **并行**: false
- **输出**: 设计文档
- **验收**: 设计覆盖所有需求

**任务**: 创建技术设计文档，包括架构、接口和数据模型。

**设计内容**:
- 架构设计
- 接口定义
- 数据模型
- 错误处理
- 安全考虑

**Agent 任务**:
```
基于以下需求创建设计文档：

需求: {{REQUIREMENTS}}

设计内容：
1. 整体架构
2. 模块划分
3. 接口定义
4. 数据流
5. 错误处理
```

---

#### Step 3: 任务拆分

- **关键**: true
- **依赖**: [2]
- **Agent**: planner
- **并行**: false
- **输出**: 实现计划
- **验收**: 任务可独立执行

**任务**: 将功能拆分为小任务，定义执行顺序。

**拆分原则**:
- 每个任务 1-2 小时
- 任务间依赖清晰
- 可独立验证
- 优先核心功能

**输出格式**:
```yaml
任务:
  - Task 1: [描述] (依赖: [], 预估: 1h)
  - Task 2: [描述] (依赖: [1], 预估: 2h)
  - Task 3: [描述] (依赖: [1], 预估: 1.5h)
  ...
```

---

#### Step 4: 实现

- **关键**: true
- **依赖**: [3]
- **Agent**: implementer
- **并行**: false
- **输出**: 实现代码 + 测试
- **验收**: 所有测试通过

**任务**: 按 TDD 方式实现功能，先写测试再写代码。

**实现顺序**:
1. 创建测试文件
2. 编写失败测试
3. 实现最小可行代码
4. 重构优化
5. 重复 2-4

**验证**:
- [ ] 所有新测试通过
- [ ] 所有现有测试通过
- [ ] 代码符合规范
- [ ] 无 TODO 注释

---

#### Step 5: 审查

- **关键**: true
- **依赖**: [4]
- **Agent**: reviewer
- **并行**: false
- **输出**: 审查报告
- **验收**: 审查无严重问题

**任务**: 对实现进行代码质量审查。

**审查项**:
- [ ] 功能完整性
- [ ] 代码质量
- [ ] 测试覆盖
- [ ] 性能考虑
- [ ] 安全性
- [ ] 文档完整

**Agent 任务**:
```
审查以下实现：

设计: {{DESIGN_DOC}}
实现文件: {{IMPLEMENTATION_FILES}}

审查内容：
1. 功能是否完整
2. 代码质量
3. 测试覆盖
4. 潜在问题
5. 改进建议
```

**输出**: 审查报告，包含问题和建议

---

#### Step 6: 修复 (如需要)

- **关键**: false
- **依赖**: [5]
- **Agent**: implementer
- **并行**: false
- **输出**: 修复后的代码
- **验收**: 审查通过

**任务**: 根据审查报告修复问题。

**条件**: 仅当 Step 5 发现问题时执行

---

## 示例使用场景

```yaml
场景: 开发用户评论功能

Step 1: 需求理解
  → 功能: 用户可以对文章发表评论
  → 约束: 需要登录，支持回复
  → 验收: 评论实时显示

Step 2: 设计
  → API: POST /api/comments
  → 数据库: comments 表
  → 实时: WebSocket

Step 3: 任务拆分
  → Task 1: 创建数据库表
  → Task 2: 实现 API
  → Task 3: 前端组件
  → Task 4: WebSocket 集成

Step 4: 实现
  → TDD 方式逐步实现

Step 5: 审查
  → 代码审查

Step 6: 修复
  → 修复审查发现的问题
```
